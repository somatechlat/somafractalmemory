{
  "openapi": "3.0.3",
  "info": {
    "title": "SomaFractalMemory API",
    "version": "1.0.0",
    "description": "OpenAPI schema for the example FastAPI service exposing SomaFractalMemoryEnterprise."
  },
  "paths": {
    "/store": {
      "post": {
        "tags": ["memories"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": { "schema": { "$ref": "#/components/schemas/StoreRequest" } }
          }
        },
        "responses": {
          "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/OkResponse" } } } }
        }
      }
    },
    "/recall": {
      "post": {
        "tags": ["memories"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": { "schema": { "$ref": "#/components/schemas/RecallRequest" } }
          }
        },
        "responses": {
          "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/MatchesResponse" } } } }
        }
      }
    },
    "/recall_batch": {
      "post": {
        "tags": ["memories"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": { "schema": { "$ref": "#/components/schemas/RecallBatchRequest" } }
          }
        },
        "responses": {
          "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/BatchesResponse" } } } }
        }
      }
    },
    "/recall_with_scores": {
      "post": {
        "tags": ["memories"],
        "parameters": [
          {"name": "query", "in": "query", "required": true, "schema": {"type": "string"}},
          {"name": "top_k", "in": "query", "required": false, "schema": {"type": "integer", "default": 5}},
          {"name": "type", "in": "query", "required": false, "schema": {"type": "string", "enum": ["episodic", "semantic"]}}
        ],
        "responses": {
          "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ScoresResponse" } } } }
        }
      }
    },
    "/recall_with_context": {
      "post": {
        "tags": ["memories"],
        "parameters": [
          {"name": "query", "in": "query", "required": true, "schema": {"type": "string"}},
          {"name": "top_k", "in": "query", "required": false, "schema": {"type": "integer", "default": 5}},
          {"name": "type", "in": "query", "required": false, "schema": {"type": "string", "enum": ["episodic", "semantic"]}}
        ],
        "requestBody": {
          "required": true,
          "content": { "application/json": { "schema": { "type": "object", "properties": {"context": {"type": "object"}}, "required": ["context"] } } }
        },
        "responses": { "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ResultsResponse" } } } } }
      }
    },
    "/store_bulk": {
      "post": {
        "tags": ["memories"],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/StoreBulkRequest" } } } },
        "responses": { "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/StoreBulkResponse" } } } } }
      }
    },
    "/link": {
      "post": {
        "tags": ["graph"],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/LinkRequest" } } } },
        "responses": { "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/OkResponse" } } } } }
      }
    },
    "/neighbors": {
      "get": {
        "tags": ["graph"],
        "parameters": [
          {"name": "coord", "in": "query", "required": true, "schema": {"type": "string"}},
          {"name": "link_type", "in": "query", "required": false, "schema": {"type": "string"}},
          {"name": "limit", "in": "query", "required": false, "schema": {"type": "integer"}}
        ],
        "responses": { "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/NeighborsResponse" } } } } }
      }
    },
    "/shortest_path": {
      "get": {
        "tags": ["graph"],
        "parameters": [
          {"name": "frm", "in": "query", "required": true, "schema": {"type": "string"}},
          {"name": "to", "in": "query", "required": true, "schema": {"type": "string"}},
          {"name": "link_type", "in": "query", "required": false, "schema": {"type": "string"}}
        ],
        "responses": { "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/PathResponse" } } } } }
      }
    },
    "/export_memories": {
      "post": {
        "tags": ["admin"],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ExportMemoriesRequest" } } } },
        "responses": { "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ExportMemoriesResponse" } } } } }
      }
    },
    "/import_memories": {
      "post": {
        "tags": ["admin"],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ImportMemoriesRequest" } } } },
        "responses": { "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ImportMemoriesResponse" } } } } }
      }
    },
    "/delete_many": {
      "post": {
        "tags": ["admin"],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/DeleteManyRequest" } } } },
        "responses": { "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/DeleteManyResponse" } } } } }
      }
    },
    "/range": {
      "get": {
        "tags": ["memories"],
        "parameters": [
          {"name": "min", "in": "query", "required": true, "schema": {"type": "string"}},
          {"name": "max", "in": "query", "required": true, "schema": {"type": "string"}},
          {"name": "type", "in": "query", "required": false, "schema": {"type": "string", "enum": ["episodic", "semantic"]}}
        ],
        "responses": { "200": { "description": "OK", "content": { "application/json": { "schema": { "type": "object", "properties": {"coords": {"type": "array", "items": {"type": "array", "items": {"type": "number"}}}} } } } } }
      }
    },
    "/stats": {
      "get": {
        "tags": ["system"],
        "responses": { "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/StatsResponse" } } } } }
      }
    },
    "/health": {
      "get": {
        "tags": ["system"],
        "responses": { "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/HealthResponse" } } } } }
      }
    }
  },
  "components": {
    "schemas": {
      "StoreRequest": {
        "type": "object",
        "properties": {
          "coord": {"type": "string"},
          "payload": {"type": "object"},
          "type": {"type": "string", "enum": ["episodic", "semantic"]}
        },
        "required": ["coord", "payload"]
      },
      "RecallRequest": {
        "type": "object",
        "properties": {
          "query": {"type": "string"},
          "top_k": {"type": "integer", "default": 5},
          "type": {"type": "string", "nullable": true, "enum": ["episodic", "semantic"]},
          "filters": {"type": "object"}
        },
        "required": ["query"]
      },
      "RecallBatchRequest": {
        "type": "object",
        "properties": {
          "queries": {"type": "array", "items": {"type": "string"}},
          "top_k": {"type": "integer", "default": 5},
          "type": {"type": "string", "nullable": true, "enum": ["episodic", "semantic"]},
          "filters": {"type": "object"}
        },
        "required": ["queries"]
      },
      "StoreBulkRequest": {
        "type": "object",
        "properties": {
          "items": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "coord": {"type": "string"},
                "payload": {"type": "object"},
                "type": {"type": "string", "enum": ["episodic", "semantic"]}
              },
              "required": ["coord", "payload"]
            }
          }
        },
        "required": ["items"]
      },
      "LinkRequest": {
        "type": "object",
        "properties": {
          "from_coord": {"type": "string"},
          "to_coord": {"type": "string"},
          "type": {"type": "string"},
          "weight": {"type": "number"}
        },
        "required": ["from_coord", "to_coord"]
      },
      "ExportMemoriesRequest": {
        "type": "object",
        "properties": {"path": {"type": "string"}},
        "required": ["path"]
      },
      "ImportMemoriesRequest": {
        "type": "object",
        "properties": {"path": {"type": "string"}, "replace": {"type": "boolean", "default": false}},
        "required": ["path"]
      },
      "DeleteManyRequest": {
        "type": "object",
        "properties": {"coords": {"type": "array", "items": {"type": "string"}}},
        "required": ["coords"]
      },
      "OkResponse": {"type": "object", "properties": {"ok": {"type": "boolean"}}, "required": ["ok"]},
      "MatchesResponse": {"type": "object", "properties": {"matches": {"type": "array", "items": {"type": "object"}}}, "required": ["matches"]},
      "BatchesResponse": {"type": "object", "properties": {"batches": {"type": "array", "items": {"type": "array", "items": {"type": "object"}}}}, "required": ["batches"]},
      "ScoreItem": {"type": "object", "properties": {"payload": {"type": "object"}, "score": {"type": "number", "nullable": true}}, "required": ["payload"]},
      "ScoresResponse": {"type": "object", "properties": {"results": {"type": "array", "items": {"$ref": "#/components/schemas/ScoreItem"}}}, "required": ["results"]},
      "ResultsResponse": {"type": "object", "properties": {"results": {"type": "array", "items": {"type": "object"}}}, "required": ["results"]},
      "NeighborsResponse": {"type": "object", "properties": {"neighbors": {"type": "array", "items": {"type": "array", "items": [{"type": "array", "items": {"type": "number"}}, {"type": "object"}]}}}, "required": ["neighbors"]},
      "PathResponse": {"type": "object", "properties": {"path": {"type": "array", "items": {"type": "array", "items": {"type": "number"}}}}, "required": ["path"]},
      "ExportMemoriesResponse": {"type": "object", "properties": {"exported": {"type": "integer"}}, "required": ["exported"]},
      "ImportMemoriesResponse": {"type": "object", "properties": {"imported": {"type": "integer"}}, "required": ["imported"]},
      "DeleteManyResponse": {"type": "object", "properties": {"deleted": {"type": "integer"}}, "required": ["deleted"]},
      "StoreBulkResponse": {"type": "object", "properties": {"stored": {"type": "integer"}}, "required": ["stored"]},
      "StatsResponse": {"type": "object", "properties": {"total_memories": {"type": "integer"}, "episodic": {"type": "integer"}, "semantic": {"type": "integer"}}, "required": ["total_memories", "episodic", "semantic"]},
      "HealthResponse": {"type": "object", "properties": {"kv_store": {"type": "boolean"}, "vector_store": {"type": "boolean"}, "graph_store": {"type": "boolean"}, "prediction_provider": {"type": "boolean"}}, "required": ["kv_store", "vector_store", "graph_store", "prediction_provider"]}
    }
  }
}
